# Vector Matcher

## Purpose
This module provides functionalities for performing similarity matching between numerical vectors, primarily using cosine similarity. It is a crucial component for applications that rely on comparing the semantic similarity of text (after being converted into embeddings by the `EmbeddingGenerator`), such as matching resumes to job descriptions or finding similar documents.

## Dependencies
- `numpy`: Used for efficient numerical operations and array manipulation.
- `sklearn.metrics.pairwise.cosine_similarity`: Provides a highly optimized function for calculating cosine similarity between vectors.

## Key Components
### `VectorMatcher` Class
This class encapsulates the vector similarity matching functionalities.

- **`__init__(self)`**
  - Initializes the `VectorMatcher` instance. Currently, it performs no complex setup.

- **`find_most_similar(self, query_vector: List[float], candidate_vectors: List[List[float]]) -> List[Tuple[int, float]]`**
  - **Purpose**: Finds the most similar candidate vectors to a given `query_vector`.
  - **Parameters**:
    - `query_vector`: A single list of floats representing the vector to compare against.
    - `candidate_vectors`: A list of lists of floats, where each inner list is a candidate vector to be compared with the `query_vector`.
  - **Returns**: A list of tuples, where each tuple contains `(index, similarity_score)`. The `index` refers to the original position of the candidate vector in the `candidate_vectors` list, and `similarity_score` is the cosine similarity between the `query_vector` and that candidate vector. The list is sorted in descending order of `similarity_score`.
  - **Mechanism**: It uses `cosine_similarity` from `sklearn.metrics.pairwise` to calculate the similarity between the `query_vector` and all `candidate_vectors`.

- **`calculate_similarity(self, vector1: List[float], vector2: List[float]) -> float`**
  - **Purpose**: Calculates the cosine similarity between two individual vectors.
  - **Parameters**:
    - `vector1`: The first vector (list of floats).
    - `vector2`: The second vector (list of floats).
  - **Returns**: A float representing the cosine similarity score between the two vectors.

## Workflow
1. **Initialization**: Create an instance of `VectorMatcher`.
2. **Vector Input**: Provide the `query_vector` and a collection of `candidate_vectors` (typically generated by an `EmbeddingGenerator`).
3. **Similarity Calculation**: Call `find_most_similar()` to get a ranked list of candidates or `calculate_similarity()` for a pairwise comparison.
4. **Interpretation**: Use the returned similarity scores to determine relevance or match quality.

## Usage Examples

```python
import numpy as np
from packages.utilities.vector_matching.vector_matcher import VectorMatcher

# Initialize the vector matcher
matcher = VectorMatcher()

# Example vectors (e.g., embeddings of text)
query_embedding = [0.1, 0.2, 0.3, 0.4, 0.5]
candidate_embeddings = [
    [0.1, 0.2, 0.3, 0.4, 0.5],  # Perfect match
    [0.0, 0.1, 0.2, 0.3, 0.4],  # High similarity
    [0.9, 0.8, 0.7, 0.6, 0.5],  # Low similarity
    [0.1, 0.2, 0.3, 0.4, 0.6]   # Very high similarity
]

# Example 1: Find most similar candidates
print("\nFinding most similar candidates:")
similar_candidates = matcher.find_most_similar(query_embedding, candidate_embeddings)
for index, score in similar_candidates:
    print(f"Candidate at index {index} (Vector: {candidate_embeddings[index]}) has similarity score: {score:.4f}")

# Example 2: Calculate similarity between two specific vectors
vector_a = [1.0, 1.0, 0.0]
vector_b = [1.0, 0.9, 0.1]
vector_c = [0.0, 0.0, 1.0]

sim_ab = matcher.calculate_similarity(vector_a, vector_b)
sim_ac = matcher.calculate_similarity(vector_a, vector_c)

print(f"\nSimilarity between vector A and B: {sim_ab:.4f}")
print(f"Similarity between vector A and C: {sim_ac:.4f}")

# Example with different dimensions (will raise error if not handled by numpy/sklearn)
# query_embedding_diff_dim = [0.1, 0.2]
# try:
#     matcher.find_most_similar(query_embedding_diff_dim, candidate_embeddings)
# except ValueError as e:
#     print(f"\nError with different dimensions: {e}")
```

## Error Handling
- The `find_most_similar` method returns an empty list if `candidate_vectors` is empty, preventing errors.
- `numpy` and `sklearn` handle dimension mismatches by raising `ValueError` if vectors are not compatible for similarity calculation.

## Testing
Testing for this module would involve:
- Unit tests for `find_most_similar` with various scenarios: empty candidate lists, perfect matches, no matches, and varying numbers of candidates.
- Unit tests for `calculate_similarity` with orthogonal, identical, and partially similar vectors.
- Edge case testing, such as vectors with all zeros (which can lead to undefined cosine similarity, depending on the library's handling).